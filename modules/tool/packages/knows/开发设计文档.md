# KnowS åŒ»å­¦çŸ¥è¯†æ£€ç´¢æ’ä»¶å¼€å‘è®¾è®¡æ–‡æ¡£

## ğŸ“‹ é¡¹ç›®æ¦‚è¿°

### é¡¹ç›®åç§°
KnowS åŒ»å­¦çŸ¥è¯†æ£€ç´¢æ’ä»¶ - FastGPT é›†æˆ

### é¡¹ç›®æè¿°
åŸºäº KnowS API çš„å…¨åŠŸèƒ½åŒ»å­¦çŸ¥è¯†æ£€ç´¢æ’ä»¶ï¼Œä¸º FastGPT æä¾›å®Œæ•´çš„åŒ»å­¦çŸ¥è¯†æœåŠ¡ã€‚é‡‡ç”¨ children æ–¹æ³•ç»„ç»‡å¤šä¸ªå­å·¥å…·ï¼Œæ”¯æŒæ–‡çŒ®æ£€ç´¢ã€è¯æ®åˆ†æã€åœºæ™¯æ€»ç»“ã€å†å²è®°å½•ç®¡ç†ç­‰åŠŸèƒ½ã€‚é€šè¿‡é…ç½® API Key æ¿€æ´»ä½¿ç”¨ã€‚

### æŠ€æœ¯æ ˆ
- **è¿è¡Œç¯å¢ƒ**: Node.js 18+
- **å¼€å‘è¯­è¨€**: TypeScript (ä¸¥æ ¼æ¨¡å¼)
- **åŒ…ç®¡ç†å™¨**: Bun
- **æµ‹è¯•æ¡†æ¶**: Vitest
- **ä»£ç è§„èŒƒ**: ESLint + Prettier
- **HTTP å®¢æˆ·ç«¯**: fetch API
- **æ¶æ„æ¨¡å¼**: children å­å·¥å…·ç»„ç»‡æ–¹å¼
- **api base url**: https://api.nullht.com

## ğŸš¨ é‡è¦å¼€å‘åŸåˆ™

### å¼€å‘é¡ºåºè¦æ±‚ï¼ˆå¿…é¡»ä¸¥æ ¼éµå®ˆï¼‰
**âš ï¸ å…³é”®åŸåˆ™ï¼šå…ˆå¼€å‘ä¸€ä¸ªå­åŠŸèƒ½ï¼Œç¡®ä¿ä»£ç å®Œå…¨æ­£ç¡®åï¼Œå†å¿«é€Ÿå¼€å‘å…¶ä»–åŠŸèƒ½**

1. **å•ä¸€åŠŸèƒ½ä¼˜å…ˆ**ï¼šé€‰æ‹©æœ€ç®€å•çš„å­å·¥å…·ï¼ˆå¦‚ searchï¼‰å…ˆå®Œæˆå¼€å‘
2. **å®Œæ•´éªŒè¯**ï¼šç¡®ä¿è¯¥å­å·¥å…·çš„æ‰€æœ‰ä»£ç ï¼ˆconfig.tsã€types.tsã€index.tsï¼‰éƒ½æ­£ç¡®æ— è¯¯
3. **æ„å»ºæµ‹è¯•**ï¼šè¿è¡Œ `npm run build` ç¡®ä¿æ„å»ºæˆåŠŸ
4. **åŠŸèƒ½æµ‹è¯•**ï¼šéªŒè¯è¯¥å­å·¥å…·åŠŸèƒ½æ­£å¸¸
5. **å¤åˆ¶æ‰©å±•**ï¼šåŸºäºæ­£ç¡®çš„æ¨¡æ¿å¿«é€Ÿå¼€å‘å…¶ä»–å­å·¥å…·
6. **é¿å…å…¨é‡å¼€å‘**ï¼šç¦æ­¢ä¸€æ¬¡æ€§å¼€å‘æ‰€æœ‰åŠŸèƒ½åé‡å¤ä¿®æ”¹å…¨éƒ¨ä»£ç 

**é”™è¯¯ç¤ºä¾‹**ï¼šâŒ åŒæ—¶å¼€å‘ 6 ä¸ªå­å·¥å…· â†’ å‘ç°é”™è¯¯ â†’ ä¿®æ”¹ 6 ä¸ªæ–‡ä»¶ â†’ é‡å¤ 5 æ¬¡
**æ­£ç¡®ç¤ºä¾‹**ï¼šâœ… å¼€å‘ search å·¥å…· â†’ éªŒè¯æ­£ç¡® â†’ å¤åˆ¶æ¨¡æ¿å¼€å‘å…¶ä»– 5 ä¸ªå·¥å…·

## ğŸ› é«˜é¢‘é”™è¯¯ä¿®å¤æŒ‡å—

### 1. TypeScript ç±»å‹é”™è¯¯

#### é”™è¯¯1ï¼šæœªå®šä¹‰ç±»å‹å¼•ç”¨
**é”™è¯¯æè¿°**ï¼š`Cannot find name 'Evidence'` æˆ–ç±»ä¼¼çš„ç±»å‹æœªå®šä¹‰é”™è¯¯
**åŸå› **ï¼šå¼•ç”¨äº†æœªå®šä¹‰æˆ–æœªæ­£ç¡®å¯¼å…¥çš„ç±»å‹
**ä¿®å¤æ–¹æ³•**ï¼š
- æ£€æŸ¥ç±»å‹å®šä¹‰æ–‡ä»¶ä¸­æ˜¯å¦å­˜åœ¨è¯¥ç±»å‹
- ç¡®ä¿æ­£ç¡®å¯¼å…¥ç±»å‹
- å¦‚æœç±»å‹ä¸å­˜åœ¨ï¼Œéœ€è¦å®šä¹‰æˆ–ç§»é™¤å¼•ç”¨

```typescript
// âŒ é”™è¯¯ä»£ç 
export interface SearchToolOutput {
  evidences: Evidence[];  // Evidence ç±»å‹æœªå®šä¹‰
}

// âœ… æ­£ç¡®ä»£ç 
export interface SearchToolOutput {
  evidences: SearchResult[];  // ä½¿ç”¨å·²å®šä¹‰çš„ç±»å‹
}

export interface SearchResult {
  id: string;
  title: string;
  content: string;
}
```

#### é”™è¯¯2ï¼šå¯¼å…¥è·¯å¾„é”™è¯¯
**é”™è¯¯æè¿°**ï¼š`Module '"../shared/types"' has no exported member 'SomeType'`
**åŸå› **ï¼šå¯¼å…¥è·¯å¾„ä¸æ­£ç¡®æˆ–å¯¼å‡ºçš„æˆå‘˜åç§°é”™è¯¯
**ä¿®å¤æ–¹æ³•**ï¼š
- æ£€æŸ¥æ–‡ä»¶è·¯å¾„æ˜¯å¦æ­£ç¡®
- ç¡®è®¤å¯¼å‡ºçš„æˆå‘˜åç§°
- ä½¿ç”¨ç›¸å¯¹è·¯å¾„æ—¶æ³¨æ„å±‚çº§å…³ç³»

```typescript
// âŒ é”™è¯¯ä»£ç 
import { Evidence } from '../shared/types';  // è·¯å¾„æˆ–å¯¼å‡ºåé”™è¯¯

// âœ… æ­£ç¡®ä»£ç 
import { SearchResult } from '../shared/types';  // ç¡®ä¿è·¯å¾„å’Œå¯¼å‡ºåæ­£ç¡®
```

### 2. FastGPT é…ç½®é”™è¯¯

#### é”™è¯¯3ï¼šå·¥å…·ç±»å‹æšä¸¾é”™è¯¯
**é”™è¯¯æè¿°**ï¼š`Type '"tool"' is not assignable to type 'ToolTypeEnum | undefined'`
**åŸå› **ï¼šä½¿ç”¨äº†é”™è¯¯çš„å·¥å…·ç±»å‹å€¼
**ä¿®å¤æ–¹æ³•**ï¼šä½¿ç”¨æ­£ç¡®çš„ ToolTypeEnum æšä¸¾å€¼

```typescript
// âŒ é”™è¯¯ä»£ç 
export const config = defineToolSet({
  type: 'tool',  // é”™è¯¯çš„ç±»å‹å€¼
  // ...
});

// âœ… æ­£ç¡®ä»£ç 
export const config = defineToolSet({
  type: ToolTypeEnum.tools,  // ä½¿ç”¨æ­£ç¡®çš„æšä¸¾å€¼
  // ...
});
```

#### é”™è¯¯4ï¼šé…ç½®ç»“æ„é”™è¯¯
**é”™è¯¯æè¿°**ï¼š`Object literal may only specify known properties, and 'version' does not exist`
**åŸå› **ï¼šé…ç½®å¯¹è±¡ä¸­ä½¿ç”¨äº†ä¸å­˜åœ¨çš„å±æ€§å
**ä¿®å¤æ–¹æ³•**ï¼šä½¿ç”¨æ­£ç¡®çš„å±æ€§å

```typescript
// âŒ é”™è¯¯ä»£ç 
versionList: [
  {
    version: '1.0.0',  // é”™è¯¯çš„å±æ€§å
    // ...
  }
]

// âœ… æ­£ç¡®ä»£ç 
versionList: [
  {
    value: '1.0.0',  // æ­£ç¡®çš„å±æ€§å
    // ...
  }
]
```

### 3. è¾“å…¥è¾“å‡ºå‚æ•°é…ç½®é”™è¯¯

#### é”™è¯¯5ï¼šç¼ºå°‘å¿…éœ€çš„å‚æ•°å±æ€§
**é”™è¯¯æè¿°**ï¼šæ„å»ºæ—¶æç¤ºç¼ºå°‘ `toolDescription` æˆ–å…¶ä»–å¿…éœ€å±æ€§
**åŸå› **ï¼šè¾“å…¥å‚æ•°é…ç½®ä¸å®Œæ•´
**ä¿®å¤æ–¹æ³•**ï¼šæ·»åŠ æ‰€æœ‰å¿…éœ€çš„å±æ€§

```typescript
// âŒ é”™è¯¯ä»£ç 
{
  key: 'query',
  valueType: WorkflowIOValueTypeEnum.string,
  label: 'æŸ¥è¯¢å†…å®¹',
  // ç¼ºå°‘ toolDescription
}

// âœ… æ­£ç¡®ä»£ç 
{
  key: 'query',
  valueType: WorkflowIOValueTypeEnum.string,
  label: 'æŸ¥è¯¢å†…å®¹',
  toolDescription: 'è¾“å…¥è¦æŸ¥è¯¢çš„åŒ»å­¦é—®é¢˜',  // æ·»åŠ å¿…éœ€å±æ€§
  renderTypeList: [FlowNodeInputTypeEnum.textarea],
  required: true
}
```

### 4. æ„å»ºæ’ä»¶é”™è¯¯

#### é”™è¯¯6ï¼šç©ºæŒ‡é’ˆè®¿é—®é”™è¯¯
**é”™è¯¯æè¿°**ï¼š`undefined is not an object (evaluating 'path.node.arguments[0].type')`
**åŸå› **ï¼šåœ¨è®¿é—®å¯¹è±¡å±æ€§å‰æ²¡æœ‰æ£€æŸ¥å¯¹è±¡æ˜¯å¦å­˜åœ¨
**ä¿®å¤æ–¹æ³•**ï¼šæ·»åŠ å­˜åœ¨æ€§æ£€æŸ¥

```typescript
// âŒ é”™è¯¯ä»£ç 
if (path.node.arguments[0].type === 'ObjectExpression') {
  // ç›´æ¥è®¿é—®å¯èƒ½ä¸º undefined çš„å±æ€§
}

// âœ… æ­£ç¡®ä»£ç 
if (path.node.arguments[0] && path.node.arguments[0].type === 'ObjectExpression') {
  // å…ˆæ£€æŸ¥å¯¹è±¡å­˜åœ¨å†è®¿é—®å±æ€§
}
```

### 5. å­—ç¬¦ç¼–ç é”™è¯¯

#### é”™è¯¯7ï¼šå…¨è§’å­—ç¬¦å¯¼è‡´è¯­æ³•é”™è¯¯
**é”™è¯¯æè¿°**ï¼šæ„å¤–çš„å­—ç¬¦æˆ–è¯­æ³•é”™è¯¯
**åŸå› **ï¼šä½¿ç”¨äº†å…¨è§’æ ‡ç‚¹ç¬¦å·
**ä¿®å¤æ–¹æ³•**ï¼šæ‰€æœ‰ä»£ç å¿…é¡»ä½¿ç”¨åŠè§’å­—ç¬¦

```typescript
// âŒ é”™è¯¯ä»£ç ï¼ˆå…¨è§’å­—ç¬¦ï¼‰
const config = {
  name: 'KnowS æœç´¢'ï¼Œ  // å…¨è§’é€—å·
  description: 'åŒ»å­¦çŸ¥è¯†æ£€ç´¢å·¥å…·'ï¼›  // å…¨è§’åˆ†å·
}

// âœ… æ­£ç¡®ä»£ç ï¼ˆåŠè§’å­—ç¬¦ï¼‰
const config = {
  name: 'KnowS æœç´¢',  // åŠè§’é€—å·
  description: 'åŒ»å­¦çŸ¥è¯†æ£€ç´¢å·¥å…·';  // åŠè§’åˆ†å·
}
```

### 6. å¤šè¯­è¨€é…ç½®é”™è¯¯

#### é”™è¯¯8ï¼šç¼ºå°‘å¤šè¯­è¨€æ”¯æŒ
**é”™è¯¯æè¿°**ï¼šé…ç½®ä¸­åªæœ‰å•ä¸€è¯­è¨€
**åŸå› **ï¼šFastGPT è¦æ±‚æ”¯æŒå¤šè¯­è¨€é…ç½®
**ä¿®å¤æ–¹æ³•**ï¼šä¸º name å’Œ description æ·»åŠ å¤šè¯­è¨€æ”¯æŒ

```typescript
// âŒ é”™è¯¯ä»£ç 
name: 'KnowS æœç´¢',
description: 'åŒ»å­¦çŸ¥è¯†æ£€ç´¢å·¥å…·',

// âœ… æ­£ç¡®ä»£ç 
name: {
  'zh-CN': 'KnowS æœç´¢',
  'en-US': 'KnowS Search'
},
description: {
  'zh-CN': 'åŒ»å­¦çŸ¥è¯†æ£€ç´¢å·¥å…·',
  'en-US': 'Medical knowledge search tool'
},
```

### 7. ToolSet é…ç½®é”™è¯¯ï¼ˆå…³é”®é”™è¯¯ï¼‰

#### é”™è¯¯9ï¼šCannot read properties of undefined (reading '0')
**é”™è¯¯æè¿°**ï¼šFastGPT ä¸»ç¨‹åºæ— æ³•æ˜¾ç¤ºæ’ä»¶ï¼Œæ§åˆ¶å°æŠ¥é”™ `Cannot read properties of undefined (reading '0')`
**åŸå› **ï¼šToolSet é…ç½®ä¸­ç¼ºå°‘ `children` æ•°ç»„é…ç½®ï¼Œæˆ–å­å·¥å…·å¯¼å‡ºç»“æ„é”™è¯¯
**ä¿®å¤æ–¹æ³•**ï¼š
1. åœ¨ä¸»é…ç½®æ–‡ä»¶ä¸­æ·»åŠ  children æ•°ç»„
2. ä¿®å¤æ‰€æœ‰å­å·¥å…·çš„å¯¼å‡ºç»“æ„

**ä¸»é…ç½®æ–‡ä»¶ä¿®å¤**ï¼š
```typescript
// âŒ é”™è¯¯ä»£ç  - ç¼ºå°‘ children æ•°ç»„
import { defineToolSet } from '@tool/type';
import { ToolTypeEnum } from '@tool/type/tool';

export default defineToolSet({
  name: { 'zh-CN': 'KnowS åŒ»å­¦çŸ¥è¯†æ£€ç´¢' },
  type: ToolTypeEnum.scientific,
  // ç¼ºå°‘ children æ•°ç»„é…ç½®
});

// âœ… æ­£ç¡®ä»£ç  - æ·»åŠ  children æ•°ç»„
import { defineToolSet } from '@tool/type';
import { ToolTypeEnum } from '@tool/type/tool';
import search from './children/search';
import analysis from './children/analysis';
import summary from './children/summary';
import details from './children/details';
import history from './children/history';
import management from './children/management';

export default defineToolSet({
  name: { 'zh-CN': 'KnowS åŒ»å­¦çŸ¥è¯†æ£€ç´¢' },
  type: ToolTypeEnum.scientific,
  children: [search, analysis, summary, details, history, management]
});
```

**å­å·¥å…·å¯¼å‡ºç»“æ„ä¿®å¤**ï¼š
```typescript
// âŒ é”™è¯¯ä»£ç  - é”™è¯¯çš„å¯¼å‡ºç»“æ„
import { InputType, OutputType, tool as toolCb } from './src/index';
import config from './config';

export default {
  InputType,
  OutputType,
  toolCb,
  config
};

// âœ… æ­£ç¡®ä»£ç  - ä½¿ç”¨ exportTool å‡½æ•°
import config from './config';
import { InputType, OutputType, tool as toolCb } from './src';
import { exportTool } from '@tool/utils/tool';

export default exportTool({
  toolCb,
  InputType,
  OutputType,
  config
});
```

**å…³é”®æ£€æŸ¥ç‚¹**ï¼š
1. ç¡®ä¿ä¸»é…ç½®æ–‡ä»¶å¯¼å…¥äº†æ‰€æœ‰å­å·¥å…·
2. ç¡®ä¿ children æ•°ç»„åŒ…å«æ‰€æœ‰å­å·¥å…·
3. ç¡®ä¿æ‰€æœ‰å­å·¥å…·ä½¿ç”¨ exportTool å‡½æ•°å¯¼å‡º
4. ç¡®ä¿å¯¼å…¥è·¯å¾„æ­£ç¡®ï¼ˆ'./src' è€Œä¸æ˜¯ './src/index'ï¼‰

## APIå®˜æ–¹æ–‡æ¡£
/Users/qinxiaoqiang/Downloads/fastgpt-plugin-1/modules/tool/packages/knows/KnowS_API_Documentation.md

## æµ‹è¯•/å¼€å‘å¸¸ç”¨æŒ‡ä»¤
- npx tsc --noEmit --skipLibCheck: ç±»å‹æ£€æŸ¥ï¼Œç¡®ä¿ TypeScript ç±»å‹æ­£ç¡®
- npx vitest run: å•å…ƒæµ‹è¯•ï¼Œä½¿ç”¨ Vitest æ¡†æ¶è¿è¡Œ JavaScript/TypeScript

- bun run bulid
- bun run dev


## ğŸ¯ åŠŸèƒ½éœ€æ±‚åˆ†æ

### æ ¸å¿ƒåŠŸèƒ½æ¨¡å—
1. **åŒ»å­¦æ–‡çŒ®æ£€ç´¢** (`/knows/ai_search`)
   - æ”¯æŒè‡ªç„¶è¯­è¨€é—®é¢˜æŸ¥è¯¢
   - è¿”å›ç›¸å…³è¯æ®å’Œç­”æ¡ˆ
   - æ”¯æŒå¤šç§ç­”æ¡ˆç±»å‹ (CLINICAL, RESEARCH, POPULAR_SCIENCE)
   - æ”¯æŒæ£€ç´¢èŒƒå›´é…ç½® (PAPER, PAPER_CN, GUIDE, MEETING)

2. **è¯æ®åˆ†æ** (`/knows/evidence/*`)
   - å•ç¯‡è¯æ® AI æ€»ç»“
   - æ‰€æœ‰è¯æ®æ€»ç»“ï¼ˆæµå¼ï¼‰
   - å•ç¯‡è¯æ®è¢«å¼•å†…å®¹é«˜äº®

3. **åœºæ™¯æ€»ç»“** (`/knows/answer`)
   - åŸºäºæ£€ç´¢ç»“æœç”Ÿæˆåœºæ™¯åŒ–ç­”æ¡ˆ
   - æ”¯æŒæµå¼è¾“å‡º

4. **æ–‡çŒ®è¯¦æƒ…** (`/knows/evidence/get_*`)
   - è‹±æ–‡æ–‡çŒ®ã€ä¸­æ–‡æ–‡çŒ®ã€æŒ‡å—ã€ä¼šè®®è¯¦æƒ…è·å–

5. **å†å²è®°å½•** (`/knows/list_*`)
   - é—®é¢˜å†å²è®°å½•ç®¡ç†
   - æ–‡çŒ®è§£è¯»å†å²è®°å½•

6. **å†…å®¹ç®¡ç†** (`/knows/create_evidence_by_pdf_file`, `/knows/auto_tagging`)
   - PDF æ–‡ä»¶ä¸Šä¼ åˆ›å»ºè¯æ®
   - è‡ªåŠ¨åŒ–æ ‡ç­¾åŠŸèƒ½

### é…ç½®è¦æ±‚
- **API Key ç®¡ç†**: ç”Ÿäº§ç¯å¢ƒ API å¯†é’¥é…ç½®
- **é”™è¯¯å¤„ç†**: å®Œå–„çš„é”™è¯¯æ•è·å’Œç”¨æˆ·å‹å¥½æç¤º
- **æ¨¡å—åŒ–æ¶æ„**: children å­å·¥å…·ç»„ç»‡æ–¹å¼

## ğŸ—ï¸ ç³»ç»Ÿæ¶æ„è®¾è®¡

### ç›®å½•ç»“æ„ï¼ˆå®Œæ•´ç‰ˆï¼‰
```
knows/
â”œâ”€â”€ config.ts                # å·¥å…·é›†é…ç½®ï¼ˆä½¿ç”¨ children æ–¹æ³•ï¼‰
â”œâ”€â”€ index.ts                 # ä¸»å…¥å£æ–‡ä»¶
â”œâ”€â”€ children/
â”‚   â”œâ”€â”€ search/              # åŒ»å­¦æ–‡çŒ®æ£€ç´¢å­å·¥å…·
â”‚   â”‚   â”œâ”€â”€ config.ts        # æ£€ç´¢å·¥å…·é…ç½®
â”‚   â”‚   â”œâ”€â”€ index.ts         # æ£€ç´¢å·¥å…·å…¥å£
â”‚   â”‚   â””â”€â”€ src/
â”‚   â”‚       â”œâ”€â”€ index.ts     # æ£€ç´¢é€»è¾‘å®ç°
â”‚   â”‚       â”œâ”€â”€ types.ts     # æ£€ç´¢ç›¸å…³ç±»å‹å®šä¹‰
â”‚   â”‚       â””â”€â”€ utils.ts     # æ£€ç´¢å·¥å…·å‡½æ•°
â”‚   â”œâ”€â”€ analysis/            # è¯æ®åˆ†æå­å·¥å…·
â”‚   â”‚   â”œâ”€â”€ config.ts        # åˆ†æå·¥å…·é…ç½®
â”‚   â”‚   â”œâ”€â”€ index.ts         # åˆ†æå·¥å…·å…¥å£
â”‚   â”‚   â””â”€â”€ src/
â”‚   â”‚       â”œâ”€â”€ index.ts     # åˆ†æé€»è¾‘å®ç°
â”‚   â”‚       â”œâ”€â”€ types.ts     # åˆ†æç›¸å…³ç±»å‹å®šä¹‰
â”‚   â”‚       â””â”€â”€ utils.ts     # åˆ†æå·¥å…·å‡½æ•°
â”‚   â”œâ”€â”€ summary/             # åœºæ™¯æ€»ç»“å­å·¥å…·
â”‚   â”‚   â”œâ”€â”€ config.ts        # æ€»ç»“å·¥å…·é…ç½®
â”‚   â”‚   â”œâ”€â”€ index.ts         # æ€»ç»“å·¥å…·å…¥å£
â”‚   â”‚   â””â”€â”€ src/
â”‚   â”‚       â”œâ”€â”€ index.ts     # æ€»ç»“é€»è¾‘å®ç°
â”‚   â”‚       â”œâ”€â”€ types.ts     # æ€»ç»“ç›¸å…³ç±»å‹å®šä¹‰
â”‚   â”‚       â””â”€â”€ utils.ts     # æ€»ç»“å·¥å…·å‡½æ•°
â”‚   â”œâ”€â”€ details/             # æ–‡çŒ®è¯¦æƒ…å­å·¥å…·
â”‚   â”‚   â”œâ”€â”€ config.ts        # è¯¦æƒ…å·¥å…·é…ç½®
â”‚   â”‚   â”œâ”€â”€ index.ts         # è¯¦æƒ…å·¥å…·å…¥å£
â”‚   â”‚   â””â”€â”€ src/
â”‚   â”‚       â”œâ”€â”€ index.ts     # è¯¦æƒ…é€»è¾‘å®ç°
â”‚   â”‚       â”œâ”€â”€ types.ts     # è¯¦æƒ…ç›¸å…³ç±»å‹å®šä¹‰
â”‚   â”‚       â””â”€â”€ utils.ts     # è¯¦æƒ…å·¥å…·å‡½æ•°
â”‚   â”œâ”€â”€ history/             # å†å²è®°å½•å­å·¥å…·
â”‚   â”‚   â”œâ”€â”€ config.ts        # å†å²è®°å½•å·¥å…·é…ç½®
â”‚   â”‚   â”œâ”€â”€ index.ts         # å†å²è®°å½•å·¥å…·å…¥å£
â”‚   â”‚   â””â”€â”€ src/
â”‚   â”‚       â”œâ”€â”€ index.ts     # å†å²è®°å½•é€»è¾‘å®ç°
â”‚   â”‚       â”œâ”€â”€ types.ts     # å†å²è®°å½•ç›¸å…³ç±»å‹å®šä¹‰
â”‚   â”‚       â””â”€â”€ utils.ts     # å†å²è®°å½•å·¥å…·å‡½æ•°
â”‚   â””â”€â”€ management/          # å†…å®¹ç®¡ç†å­å·¥å…·
â”‚       â”œâ”€â”€ config.ts        # å†…å®¹ç®¡ç†å·¥å…·é…ç½®
â”‚       â”œâ”€â”€ index.ts         # å†…å®¹ç®¡ç†å·¥å…·å…¥å£
â”‚       â””â”€â”€ src/
â”‚           â”œâ”€â”€ index.ts     # å†…å®¹ç®¡ç†é€»è¾‘å®ç°
â”‚           â”œâ”€â”€ types.ts     # å†…å®¹ç®¡ç†ç›¸å…³ç±»å‹å®šä¹‰
â”‚           â””â”€â”€ utils.ts     # å†…å®¹ç®¡ç†å·¥å…·å‡½æ•°
â”œâ”€â”€ shared/                  # å…±äº«æ¨¡å—
â”‚   â”œâ”€â”€ types.ts             # é€šç”¨ç±»å‹å®šä¹‰
â”‚   â”œâ”€â”€ api.ts               # API å®¢æˆ·ç«¯
â”‚   â”œâ”€â”€ config.ts            # é…ç½®ç®¡ç†
â”‚   â””â”€â”€ utils.ts             # é€šç”¨å·¥å…·å‡½æ•°
â”œâ”€â”€ package.json
â”œâ”€â”€ tsconfig.json
â”œâ”€â”€ README.md
â”œâ”€â”€ KnowS_API_Documentation.md  # API æ–‡æ¡£ï¼ˆä¿ç•™ï¼‰
â””â”€â”€ INITIAL.md                  # åˆå§‹éœ€æ±‚ï¼ˆä¿ç•™ï¼‰
```

### æ ¸å¿ƒæ¨¡å—è®¾è®¡

#### 1. æ’ä»¶é…ç½® (config.ts)
```typescript
export const config = {
  id: 'knows-ai-search',
  name: 'KnowS AI æ£€ç´¢',
  description: 'åŸºäº KnowS API çš„æ™ºèƒ½æ£€ç´¢æ’ä»¶ï¼Œæä¾›é—®ç­”ã€è¯æ®æ€»ç»“å’Œé«˜äº®åŠŸèƒ½',
  version: '1.0.0',
  author: 'Xiaoyibao Team',
  // è¾“å…¥é…ç½®
  input: [
    {
      key: 'apiKey',
      type: 'string',
      label: 'API Key',
      description: 'KnowS API å¯†é’¥',
      required: true
    },
    {
      key: 'environment',
      type: 'hidden',
      defaultValue: 'production'
    },
    {
      key: 'searchMode',
      type: 'hidden',
      defaultValue: 'ai_search'
    },
    {
      key: 'query',
      type: 'string',
      label: 'æŸ¥è¯¢å†…å®¹',
      description: 'è¾“å…¥é—®é¢˜æˆ–è¯æ® ID',
      required: true
    },
    {
      key: 'answerType',
      type: 'multiSelect',
      label: 'ç­”æ¡ˆç±»å‹',
      description: 'é€‰æ‹©ç­”æ¡ˆç±»å‹ï¼ˆä»…é—®ç­”æ¨¡å¼ï¼‰',
      options: [
        { label: 'ä¸´åºŠ', value: 'CLINICAL' },
        { label: 'ç ”ç©¶', value: 'RESEARCH' },
        { label: 'ç§‘æ™®', value: 'POPULAR_SCIENCE' }
      ],
      showCondition: { searchMode: 'ai_search' }
    }
  ],
  // è¾“å‡ºé…ç½®
  output: [
    {
      key: 'result',
      type: 'string',
      label: 'æ£€ç´¢ç»“æœ',
      description: 'å¤„ç†åçš„æ£€ç´¢ç»“æœï¼ˆé»˜è®¤ä¸ºä¸´åºŠç±»å‹ç­”æ¡ˆï¼‰'
    },
    {
      key: 'evidences',
      type: 'array',
      label: 'è¯æ®åˆ—è¡¨',
      description: 'ç›¸å…³è¯æ®ä¿¡æ¯'
    },
    {
      key: 'metadata',
      type: 'object',
      label: 'å…ƒæ•°æ®',
      description: 'è¯·æ±‚ç›¸å…³çš„å…ƒæ•°æ®ä¿¡æ¯'
    }
  ]
};
```

#### 2. API ç±»å‹å®šä¹‰ (types/ApiTypes.ts)
```typescript
// åŸºç¡€å“åº”ç±»å‹
export interface BaseApiResponse {
  success: boolean;
  message?: string;
  timestamp: number;
}

// AI æœç´¢è¯·æ±‚
export interface AiSearchRequest {
  question: string;
  answer_type: AnswerType[];
}

// AI æœç´¢å“åº”
export interface AiSearchResponse extends BaseApiResponse {
  data: {
    question_id: string;
    evidences: Evidence[];
    answer?: string;
  };
}

// è¯æ®ç±»å‹
export interface Evidence {
  evidence_id: string;
  title: string;
  content: string;
  source: string;
  relevance_score: number;
  metadata?: Record<string, any>;
}

// ç­”æ¡ˆç±»å‹æšä¸¾
export type AnswerType = 'CLINICAL' | 'RESEARCH' | 'POPULAR_SCIENCE';

// è¯æ®æ€»ç»“è¯·æ±‚
export interface EvidenceSummaryRequest {
  evidence_id: string;
}

// è¯æ®æ€»ç»“å“åº”
export interface EvidenceSummaryResponse extends BaseApiResponse {
  data: {
    summary: string;
    key_points: string[];
  };
}

// è¯æ®é«˜äº®å“åº”
export interface EvidenceHighlightResponse extends BaseApiResponse {
  data: {
    highlights: HighlightBlock[];
  };
}

// é«˜äº®å—ç±»å‹
export interface HighlightBlock {
  block_id: string;
  block_type: 'header' | 'caption' | 'table' | 'paragraph';
  text: string;
  files: string[];
  page_number: number;
}

// æµå¼å“åº”ç±»å‹
export interface StreamResponse {
  created: number;
  data: {
    content?: string;
    type?: 'END';
  };
  id: string;
}

//å…¥å£æ–‡ä»¶éœ€è¦ä½¿ç”¨ç³»ç»Ÿæä¾›çš„ exportTool æœåŠ¡
import { exportTool } from '@tool/utils/tool'; ä½¿ç”¨è¿™ä¸ªç³»ç»ŸæœåŠ¡

s#### 3. é”™è¯¯å¤„ç†ç±»å‹ (types/ErrorTypes.ts)
```typescript
// é”™è¯¯ç å¸¸é‡
export const ERROR_CODES = {
  INVALID_API_KEY: 'INVALID_API_KEY',
  NETWORK_ERROR: 'NETWORK_ERROR',
  RATE_LIMIT_EXCEEDED: 'RATE_LIMIT_EXCEEDED',
  INVALID_QUERY: 'INVALID_QUERY',
  API_UNAVAILABLE: 'API_UNAVAILABLE',
  TIMEOUT_ERROR: 'TIMEOUT_ERROR',
  VALIDATION_ERROR: 'VALIDATION_ERROR'
} as const;

export type ErrorCode = typeof ERROR_CODES[keyof typeof ERROR_CODES];

// ç»Ÿä¸€é”™è¯¯å¤„ç†ç±»
export class KnowsError extends Error {
  constructor(
    message: string,
    public readonly code: ErrorCode,
    public readonly statusCode?: number,
    public readonly originalError?: Error
  ) {
    super(message);
    this.name = 'KnowsError';
  }

  /**
   * åˆ›å»ºç”¨æˆ·å‹å¥½çš„é”™è¯¯ä¿¡æ¯
   */
  getUserFriendlyMessage(): string {
    switch (this.code) {
      case ERROR_CODES.INVALID_API_KEY:
        return 'API å¯†é’¥æ— æ•ˆï¼Œè¯·æ£€æŸ¥é…ç½®';
      case ERROR_CODES.NETWORK_ERROR:
        return 'ç½‘ç»œè¿æ¥å¤±è´¥ï¼Œè¯·æ£€æŸ¥ç½‘ç»œçŠ¶æ€';
      case ERROR_CODES.RATE_LIMIT_EXCEEDED:
        return 'API è°ƒç”¨é¢‘ç‡è¿‡é«˜ï¼Œè¯·ç¨åé‡è¯•';
      case ERROR_CODES.INVALID_QUERY:
        return 'æŸ¥è¯¢å†…å®¹æ ¼å¼ä¸æ­£ç¡®ï¼Œè¯·é‡æ–°è¾“å…¥';
      case ERROR_CODES.API_UNAVAILABLE:
        return 'KnowS æœåŠ¡æš‚æ—¶ä¸å¯ç”¨ï¼Œè¯·ç¨åé‡è¯•';
      case ERROR_CODES.TIMEOUT_ERROR:
        return 'è¯·æ±‚è¶…æ—¶ï¼Œè¯·ç¨åé‡è¯•';
      default:
        return this.message;
    }
  }
}

// æ€§èƒ½ç›‘æ§ç±»å‹
export interface PerformanceMetrics {
  requestStartTime: number;
  requestEndTime: number;
  duration: number;
  apiEndpoint: string;
  success: boolean;
  errorCode?: ErrorCode;
  queryLength?: number;
  responseSize?: number;
}
```

#### 4. é…ç½®éªŒè¯å·¥å…· (utils/validation.ts)
```typescript
import { KnowsError, ERROR_CODES } from '../types/ErrorTypes';
import type { PluginInput, AnswerType } from '../types/PluginTypes';

/**
 * éªŒè¯ API Key æ ¼å¼å’Œæœ‰æ•ˆæ€§
 */
export const validateApiKey = (apiKey: string): void => {
  if (!apiKey || apiKey.trim().length === 0) {
    throw new KnowsError('API Key ä¸èƒ½ä¸ºç©º', ERROR_CODES.INVALID_API_KEY);
  }
  
  // æ£€æŸ¥æ˜¯å¦åŒ…å«æµ‹è¯•ç¯å¢ƒæ ‡è¯†
  if (apiKey.toLowerCase().includes('test') || apiKey.toLowerCase().includes('demo')) {
    throw new KnowsError('è¯·ä½¿ç”¨æœ‰æ•ˆçš„ç”Ÿäº§ç¯å¢ƒ API Key', ERROR_CODES.INVALID_API_KEY);
  }
  
  // API Key é•¿åº¦éªŒè¯
  if (apiKey.length < 20) {
    throw new KnowsError('API Key æ ¼å¼ä¸æ­£ç¡®ï¼Œé•¿åº¦è¿‡çŸ­', ERROR_CODES.INVALID_API_KEY);
  }
  
  // API Key æ ¼å¼éªŒè¯ï¼ˆåªå…è®¸å­—æ¯ã€æ•°å­—ã€ä¸‹åˆ’çº¿ã€è¿å­—ç¬¦ï¼‰
  const apiKeyPattern = /^[a-zA-Z0-9_-]+$/;
  if (!apiKeyPattern.test(apiKey)) {
    throw new KnowsError('API Key åŒ…å«æ— æ•ˆå­—ç¬¦', ERROR_CODES.INVALID_API_KEY);
  }
};

/**
 * éªŒè¯æŸ¥è¯¢å†…å®¹
 */
export const validateQuery = (query: string): void => {
  if (!query || query.trim().length === 0) {
    throw new KnowsError('æŸ¥è¯¢å†…å®¹ä¸èƒ½ä¸ºç©º', ERROR_CODES.INVALID_QUERY);
  }
  
  // æŸ¥è¯¢é•¿åº¦é™åˆ¶
  if (query.length > 1000) {
    throw new KnowsError('æŸ¥è¯¢å†…å®¹è¿‡é•¿ï¼Œè¯·æ§åˆ¶åœ¨1000å­—ç¬¦ä»¥å†…', ERROR_CODES.INVALID_QUERY);
  }
  
  // ç§»é™¤æ½œåœ¨çš„æ¶æ„å†…å®¹
  const sanitizedQuery = sanitizeInput(query);
  if (sanitizedQuery !== query) {
    throw new KnowsError('æŸ¥è¯¢å†…å®¹åŒ…å«ä¸å®‰å…¨å­—ç¬¦', ERROR_CODES.VALIDATION_ERROR);
  }
};

/**
 * éªŒè¯ç­”æ¡ˆç±»å‹
 */
export const validateAnswerType = (answerType: AnswerType[]): void => {
  if (!Array.isArray(answerType) || answerType.length === 0) {
    throw new KnowsError('ç­”æ¡ˆç±»å‹ä¸èƒ½ä¸ºç©º', ERROR_CODES.VALIDATION_ERROR);
  }
  
  const validTypes: AnswerType[] = ['CLINICAL', 'RESEARCH', 'POPULAR_SCIENCE'];
  const invalidTypes = answerType.filter(type => !validTypes.includes(type));
  
  if (invalidTypes.length > 0) {
    throw new KnowsError(
      `æ— æ•ˆçš„ç­”æ¡ˆç±»å‹: ${invalidTypes.join(', ')}`, 
      ERROR_CODES.VALIDATION_ERROR
    );
  }
};

/**
 * è¾“å…¥å†…å®¹å®‰å…¨æ¸…ç†
 */
export const sanitizeInput = (input: string): string => {
  return input
    .replace(/<script\b[^<]*(?:(?!<\/script>)<[^<]*)*<\/script>/gi, '') // ç§»é™¤ script æ ‡ç­¾
    .replace(/javascript:/gi, '') // ç§»é™¤ javascript: åè®®
    .replace(/on\w+\s*=/gi, '') // ç§»é™¤äº‹ä»¶å¤„ç†å™¨
    .trim();
};

/**
 * å®Œæ•´çš„è¾“å…¥éªŒè¯
 */
export const validateInput = {
  /**
   * AI æœç´¢è¾“å…¥éªŒè¯
   */
  aiSearch: (input: { query: string; answerType: AnswerType[] }): void => {
    validateQuery(input.query);
    validateAnswerType(input.answerType);
  },
  
  /**
   * å®Œæ•´é…ç½®éªŒè¯
   */
  fullConfig: (input: PluginInput): void => {
    validateApiKey(input.apiKey);
    validateQuery(input.query);
    if (input.answerType) {
      validateAnswerType(input.answerType);
    }
  }
};
```

#### 5. æ€§èƒ½ç›‘æ§å·¥å…· (utils/performance.ts)
```typescript
import type { PerformanceMetrics, ErrorCode } from '../types/ErrorTypes';

/**
 * æ€§èƒ½ç›‘æ§ç±»
 */
export class PerformanceMonitor {
  private metrics: PerformanceMetrics[] = [];
  private readonly MAX_METRICS_HISTORY = 100;

  /**
   * å¼€å§‹æ€§èƒ½ç›‘æ§
   */
  startRequest(apiEndpoint: string): number {
    return Date.now();
  }

  /**
   * ç»“æŸæ€§èƒ½ç›‘æ§å¹¶è®°å½•æŒ‡æ ‡
   */
  endRequest(
    startTime: number,
    apiEndpoint: string,
    success: boolean,
    errorCode?: ErrorCode,
    queryLength?: number,
    responseSize?: number
  ): PerformanceMetrics {
    const endTime = Date.now();
    const duration = endTime - startTime;

    const metrics: PerformanceMetrics = {
      requestStartTime: startTime,
      requestEndTime: endTime,
      duration,
      apiEndpoint,
      success,
      errorCode,
      queryLength,
      responseSize
    };

    this.recordMetrics(metrics);
    this.logPerformance(metrics);

    return metrics;
  }

  /**
   * è®°å½•æ€§èƒ½æŒ‡æ ‡
   */
  private recordMetrics(metrics: PerformanceMetrics): void {
    this.metrics.push(metrics);
    
    // ä¿æŒå†å²è®°å½•åœ¨åˆç†èŒƒå›´å†…
    if (this.metrics.length > this.MAX_METRICS_HISTORY) {
      this.metrics = this.metrics.slice(-this.MAX_METRICS_HISTORY);
    }
  }

  /**
   * è®°å½•æ€§èƒ½æ—¥å¿—
   */
  private logPerformance(metrics: PerformanceMetrics): void {
    const { apiEndpoint, duration, success, errorCode, queryLength } = metrics;
    
    // åŸºç¡€æ€§èƒ½æ—¥å¿—
    console.log(
      `[Performance] ${apiEndpoint}: ${duration}ms, ` +
      `Success: ${success}, Query Length: ${queryLength || 'N/A'}`
    );

    // æ€§èƒ½è­¦å‘Š
    if (duration > 10000) {
      console.warn(`[Performance Warning] è¯·æ±‚è€—æ—¶è¿‡é•¿: ${duration}ms`);
    }

    if (duration > 30000) {
      console.error(`[Performance Error] è¯·æ±‚ä¸¥é‡è¶…æ—¶: ${duration}ms`);
    }

    // é”™è¯¯æ—¥å¿—
    if (!success && errorCode) {
      console.error(`[Performance Error] è¯·æ±‚å¤±è´¥: ${errorCode}, è€—æ—¶: ${duration}ms`);
    }
  }

  /**
   * è·å–æ€§èƒ½ç»Ÿè®¡ä¿¡æ¯
   */
  getStatistics(): {
    totalRequests: number;
    successRate: number;
    averageDuration: number;
    maxDuration: number;
    minDuration: number;
  } {
    if (this.metrics.length === 0) {
      return {
        totalRequests: 0,
        successRate: 0,
        averageDuration: 0,
        maxDuration: 0,
        minDuration: 0
      };
    }

    const successfulRequests = this.metrics.filter(m => m.success).length;
    const durations = this.metrics.map(m => m.duration);

    return {
      totalRequests: this.metrics.length,
      successRate: (successfulRequests / this.metrics.length) * 100,
      averageDuration: durations.reduce((a, b) => a + b, 0) / durations.length,
      maxDuration: Math.max(...durations),
      minDuration: Math.min(...durations)
    };
  }
}

// å…¨å±€æ€§èƒ½ç›‘æ§å®ä¾‹
export const performanceMonitor = new PerformanceMonitor();

/**
 * æ€§èƒ½ç›‘æ§è£…é¥°å™¨
 */
export const withPerformanceMonitoring = <T extends any[], R>(
  fn: (...args: T) => Promise<R>,
  apiEndpoint: string
) => {
  return async (...args: T): Promise<R> => {
    const startTime = performanceMonitor.startRequest(apiEndpoint);
    let success = false;
    let errorCode: ErrorCode | undefined;
    let result: R;

    try {
      result = await fn(...args);
      success = true;
      return result;
    } catch (error) {
      if (error instanceof KnowsError) {
        errorCode = error.code;
      }
      throw error;
    } finally {
      performanceMonitor.endRequest(
        startTime,
        apiEndpoint,
        success,
        errorCode
      );
    }
  };
};
```

#### 6. é”™è¯¯å¤„ç†å·¥å…· (utils/errorHandler.ts)
```typescript
import { KnowsError, ERROR_CODES, type ErrorCode } from '../types/ErrorTypes';

/**
 * ç»Ÿä¸€é”™è¯¯å¤„ç†å™¨
 */
export class ErrorHandler {
  /**
   * å¤„ç† API å“åº”é”™è¯¯
   */
  static handleApiError(error: any, endpoint: string): never {
    console.error(`[ErrorHandler] API é”™è¯¯ ${endpoint}:`, error);

    if (error instanceof KnowsError) {
      throw error;
    }

    // ç½‘ç»œé”™è¯¯
    if (error.name === 'TypeError' && error.message.includes('fetch')) {
      throw new KnowsError(
        'ç½‘ç»œè¿æ¥å¤±è´¥ï¼Œè¯·æ£€æŸ¥ç½‘ç»œçŠ¶æ€',
        ERROR_CODES.NETWORK_ERROR,
        undefined,
        error
      );
    }

    // HTTP çŠ¶æ€ç é”™è¯¯
    if (error.status) {
      switch (error.status) {
        case 401:
          throw new KnowsError(
            'API å¯†é’¥æ— æ•ˆæˆ–å·²è¿‡æœŸ',
            ERROR_CODES.INVALID_API_KEY,
            401,
            error
          );
        case 429:
          throw new KnowsError(
            'API è°ƒç”¨é¢‘ç‡è¿‡é«˜ï¼Œè¯·ç¨åé‡è¯•',
            ERROR_CODES.RATE_LIMIT_EXCEEDED,
            429,
            error
          );
        case 500:
        case 502:
        case 503:
          throw new KnowsError(
            'KnowS æœåŠ¡æš‚æ—¶ä¸å¯ç”¨ï¼Œè¯·ç¨åé‡è¯•',
            ERROR_CODES.API_UNAVAILABLE,
            error.status,
            error
          );
        case 408:
          throw new KnowsError(
            'è¯·æ±‚è¶…æ—¶ï¼Œè¯·ç¨åé‡è¯•',
            ERROR_CODES.TIMEOUT_ERROR,
            408,
            error
          );
        default:
          throw new KnowsError(
            `API è¯·æ±‚å¤±è´¥: ${error.status} ${error.statusText}`,
            ERROR_CODES.NETWORK_ERROR,
            error.status,
            error
          );
      }
    }

    // è¶…æ—¶é”™è¯¯
    if (error.name === 'AbortError' || error.message.includes('timeout')) {
      throw new KnowsError(
        'è¯·æ±‚è¶…æ—¶ï¼Œè¯·ç¨åé‡è¯•',
        ERROR_CODES.TIMEOUT_ERROR,
        undefined,
        error
      );
    }

    // æœªçŸ¥é”™è¯¯
    throw new KnowsError(
      error.message || 'æœªçŸ¥é”™è¯¯ï¼Œè¯·ç¨åé‡è¯•',
      ERROR_CODES.NETWORK_ERROR,
      undefined,
      error
    );
  }

  /**
   * å¤„ç†éªŒè¯é”™è¯¯
   */
  static handleValidationError(message: string, originalError?: Error): never {
    throw new KnowsError(
      message,
      ERROR_CODES.VALIDATION_ERROR,
      undefined,
      originalError
    );
  }

  /**
   * è·å–ç”¨æˆ·å‹å¥½çš„é”™è¯¯ä¿¡æ¯
   */
  static getUserFriendlyMessage(error: any): string {
    if (error instanceof KnowsError) {
      return error.getUserFriendlyMessage();
    }

    // é»˜è®¤é”™è¯¯ä¿¡æ¯
    return 'KnowS æ£€ç´¢é‡åˆ°æœªçŸ¥é”™è¯¯ï¼Œè¯·ç¨åé‡è¯•';
  }
}
```
``
#### 7. API å®¢æˆ·ç«¯ (services/apiClient.ts)
```typescript
import type { 
  AiSearchRequest, 
  AiSearchResponse
} from '../types/ApiTypes';
import { ErrorHandler } from '../utils/errorHandler';
import { performanceMonitor } from '../utils/performance';

export class KnowsApiClient {
  private baseUrl: string;
  private apiKey: string;
  private readonly timeout: number = 30000; // 30ç§’è¶…æ—¶

  constructor(apiKey: string) {
    this.baseUrl = 'https://api.nullht.com'; // å›ºå®šä½¿ç”¨ç”Ÿäº§ç¯å¢ƒ
    this.apiKey = apiKey;
  }

  /**
   * é€šç”¨è¯·æ±‚æ–¹æ³•ï¼Œé›†æˆé”™è¯¯å¤„ç†å’Œæ€§èƒ½ç›‘æ§
   */
  private async request<T>(
    endpoint: string, 
    options: RequestInit = {}
  ): Promise<T> {
    const url = `${this.baseUrl}${endpoint}`;
    const startTime = performanceMonitor.startRequest(endpoint);
    
    try {
      // åˆ›å»º AbortController ç”¨äºè¶…æ—¶æ§åˆ¶
      const controller = new AbortController();
      const timeoutId = setTimeout(() => controller.abort(), this.timeout);

      const response = await fetch(url, {
        ...options,
        headers: {
          'Content-Type': 'application/json',
          'x-api-key': this.apiKey,
          ...options.headers,
        },
        signal: controller.signal,
      });

      clearTimeout(timeoutId);

      if (!response.ok) {
        const errorData = await response.text();
        const error = new Error(`HTTP ${response.status}: ${response.statusText}`);
        (error as any).status = response.status;
        (error as any).statusText = response.statusText;
        (error as any).responseData = errorData;
        throw error;
      }

      const data = await response.json();
      
      // è®°å½•æˆåŠŸçš„æ€§èƒ½æŒ‡æ ‡
      performanceMonitor.endRequest(
        startTime,
        endpoint,
        true,
        undefined,
        options.body ? (options.body as string).length : undefined,
        JSON.stringify(data).length
      );

      return data;
    } catch (error) {
      // è®°å½•å¤±è´¥çš„æ€§èƒ½æŒ‡æ ‡
      performanceMonitor.endRequest(
        startTime,
        endpoint,
        false,
        undefined,
        options.body ? (options.body as string).length : undefined
      );

      // ç»Ÿä¸€é”™è¯¯å¤„ç†
      ErrorHandler.handleApiError(error, endpoint);
    }
  }

  /**
   * AI é—®ç­”æ£€ç´¢
   */
  async aiSearch(request: AiSearchRequest): Promise<AiSearchResponse> {
    console.log(`[KnowsApiClient] å‘èµ· AI æœç´¢è¯·æ±‚: ${request.question.substring(0, 50)}...`);
    
    return this.request<AiSearchResponse>('/knows/ai_search', {
      method: 'POST',
      body: JSON.stringify(request),
    });
  }
}
```

#### 8. æœåŠ¡å±‚ (services/knowsService.ts)
```typescript
import { KnowsApiClient } from './apiClient';
import type { 
  AiSearchRequest, 
  AiSearchResponse,
  PluginInput,
  PluginOutput 
} from '../types/ApiTypes';
import { validateInput } from '../utils/validation';
import { ErrorHandler } from '../utils/errorHandler';
import { performanceMonitor } from '../utils/performance';

export class KnowsService {
  private apiClient: KnowsApiClient;

  constructor(apiKey: string) {
    this.apiClient = new KnowsApiClient(apiKey);
  }

  /**
   * å¤„ç† AI é—®ç­”æ£€ç´¢ï¼Œé›†æˆè¾“å…¥éªŒè¯å’Œé”™è¯¯å¤„ç†
   */
  async handleAiSearch(input: PluginInput): Promise<PluginOutput> {
    const startTime = Date.now();
    
    try {
      console.log('[KnowsService] å¼€å§‹å¤„ç† AI æœç´¢è¯·æ±‚');
      
      // è¾“å…¥éªŒè¯
      const validationResult = validateInput(input);
      if (!validationResult.isValid) {
        throw ErrorHandler.createValidationError(validationResult.errors);
      }

      // æ„å»º API è¯·æ±‚
      const request: AiSearchRequest = {
        question: validationResult.sanitizedInput.question,
        answer_type: validationResult.sanitizedInput.answerType || ['CLINICAL'],
        top_k: 10,
        score_threshold: 0.5
      };

      console.log(`[KnowsService] å‘é€è¯·æ±‚åˆ° API: ${request.question.substring(0, 50)}...`);
      
      // è°ƒç”¨ API
      const response = await this.apiClient.aiSearch(request);
      
      // éªŒè¯å“åº”æ•°æ®
      if (!response || !response.data) {
        throw new Error('API è¿”å›æ•°æ®æ ¼å¼é”™è¯¯');
      }

      // è®°å½•æ€§èƒ½æŒ‡æ ‡
      const duration = Date.now() - startTime;
      performanceMonitor.recordMetric({
        operation: 'ai_search',
        duration,
        success: true,
        timestamp: new Date(),
        metadata: {
          questionLength: request.question.length,
          resultCount: response.data.length
        }
      });

      console.log(`[KnowsService] AI æœç´¢å®Œæˆï¼Œè¿”å› ${response.data.length} æ¡ç»“æœï¼Œè€—æ—¶ ${duration}ms`);

      // æ„å»ºè¿”å›ç»“æœ
      return {
        result: response.data.map(item => ({
          title: item.title || 'æ— æ ‡é¢˜',
          content: item.content || '',
          score: item.score || 0,
          source: item.source || 'æœªçŸ¥æ¥æº'
        })),
        metadata: {
          total: response.data.length,
          query: request.question,
          timestamp: new Date().toISOString(),
          processingTime: duration
        }
      };

    } catch (error) {
      // è®°å½•å¤±è´¥çš„æ€§èƒ½æŒ‡æ ‡
      const duration = Date.now() - startTime;
      performanceMonitor.recordMetric({
        operation: 'ai_search',
        duration,
        success: false,
        timestamp: new Date(),
        error: error instanceof Error ? error.message : 'æœªçŸ¥é”™è¯¯'
      });

      console.error('[KnowsService] AI æœç´¢å¤±è´¥:', error);
      
      // ç»Ÿä¸€é”™è¯¯å¤„ç†
      throw ErrorHandler.handleServiceError(error, 'AI æœç´¢');
    }
  }
}
```

#### 9. ä¸»å…¥å£æ–‡ä»¶ (index.ts)
```typescript
import { KnowsService } from './services/knowsService';
import type { PluginInput, PluginOutput } from './types/ApiTypes';
import { validateInput } from './utils/validation';
import { ErrorHandler } from './utils/errorHandler';
import { performanceMonitor } from './utils/performance';

/**
 * Knows æ’ä»¶ä¸»å…¥å£å‡½æ•°
 * é›†æˆè¾“å…¥éªŒè¯ã€é”™è¯¯å¤„ç†å’Œæ€§èƒ½ç›‘æ§
 */
export default async function main(input: PluginInput): Promise<PluginOutput> {
  const startTime = Date.now();
  
  try {
    console.log('[Knows Plugin] å¼€å§‹å¤„ç†è¯·æ±‚');
    
    // åŸºç¡€è¾“å…¥éªŒè¯
    if (!input) {
      throw ErrorHandler.createValidationError(['è¾“å…¥å‚æ•°ä¸èƒ½ä¸ºç©º']);
    }

    // API Key éªŒè¯
    if (!input.apiKey) {
      throw ErrorHandler.createValidationError(['API Key ä¸èƒ½ä¸ºç©º']);
    }

    // è¯¦ç»†è¾“å…¥éªŒè¯
    const validationResult = validateInput(input);
    if (!validationResult.isValid) {
      throw ErrorHandler.createValidationError(validationResult.errors);
    }

    console.log(`[Knows Plugin] è¾“å…¥éªŒè¯é€šè¿‡ï¼Œé—®é¢˜: ${input.question.substring(0, 50)}...`);

    // åˆå§‹åŒ–æœåŠ¡
    const knowsService = new KnowsService(input.apiKey);
    
    // æ‰§è¡Œ AI é—®ç­”æ£€ç´¢
    const result = await knowsService.handleAiSearch(input);
    
    // è®°å½•æˆåŠŸçš„æ€§èƒ½æŒ‡æ ‡
    const duration = Date.now() - startTime;
    performanceMonitor.recordMetric({
      operation: 'plugin_main',
      duration,
      success: true,
      timestamp: new Date(),
      metadata: {
        questionLength: input.question.length,
        resultCount: result.result.length
      }
    });

    console.log(`[Knows Plugin] è¯·æ±‚å¤„ç†å®Œæˆï¼Œè€—æ—¶ ${duration}ms`);
    
    return result;

  } catch (error) {
    // è®°å½•å¤±è´¥çš„æ€§èƒ½æŒ‡æ ‡
    const duration = Date.now() - startTime;
    performanceMonitor.recordMetric({
      operation: 'plugin_main',
      duration,
      success: false,
      timestamp: new Date(),
      error: error instanceof Error ? error.message : 'æœªçŸ¥é”™è¯¯'
    });

    console.error('[Knows Plugin] è¯·æ±‚å¤„ç†å¤±è´¥:', error);
    
    // ç»Ÿä¸€é”™è¯¯å¤„ç†å¹¶è¿”å›ç”¨æˆ·å‹å¥½çš„é”™è¯¯ä¿¡æ¯
    const handledError = ErrorHandler.handleServiceError(error, 'Knows æ’ä»¶');
    
    // è¿”å›é”™è¯¯ç»“æœè€Œä¸æ˜¯æŠ›å‡ºå¼‚å¸¸ï¼Œç¡®ä¿æ’ä»¶ç¨³å®šæ€§
    return {
      result: [],
      metadata: {
        total: 0,
        query: input?.question || '',
        timestamp: new Date().toISOString(),
        processingTime: duration,
        error: handledError.message
      }
    };
  }
}
```

## ğŸ§ª æµ‹è¯•ç­–ç•¥

### æµ‹è¯•è¦†ç›–èŒƒå›´
1. **å•å…ƒæµ‹è¯•**: å„ä¸ªæœåŠ¡æ¨¡å—çš„åŠŸèƒ½æµ‹è¯•
2. **é›†æˆæµ‹è¯•**: API å®¢æˆ·ç«¯ä¸çœŸå® API çš„é›†æˆæµ‹è¯•
3. **é”™è¯¯å¤„ç†æµ‹è¯•**: å„ç§å¼‚å¸¸æƒ…å†µçš„å¤„ç†æµ‹è¯•
4. **è¾¹ç•Œæ¡ä»¶æµ‹è¯•**: è¾“å…¥éªŒè¯å’Œè¾¹ç•Œå€¼æµ‹è¯•

### å¼€å‘æ—¥å¿—

### 2024-12-19 TypeScriptç±»å‹é”™è¯¯ä¿®å¤
**ä¿®å¤å†…å®¹ï¼š**
1. **ErrorTypes.tsç±»å‹å®šä¹‰ä¼˜åŒ–**
   - ä¿®å¤KnowsErrorç±»æ„é€ å‡½æ•°ä¸­çš„å¯é€‰å‚æ•°å¤„ç†
   - ä½¿ç”¨ç©ºå€¼åˆå¹¶æ“ä½œç¬¦(??)æ›¿ä»£é€»è¾‘æˆ–æ“ä½œç¬¦(||)
   - ä¼˜åŒ–PerformanceMetricsæ¥å£ï¼Œå°†errorå’Œmetadataè®¾ä¸ºå¯é€‰å±æ€§

2. **validation.tsç±»å‹å…¼å®¹æ€§ä¿®å¤**
   - ä¿®å¤answerTypeå­—æ®µçš„undefinedç±»å‹é—®é¢˜
   - ä¸ºanswerTypeæä¾›é»˜è®¤å€¼['CLINICAL']ï¼Œé¿å…undefinedèµ‹å€¼

3. **performance.tsæ€§èƒ½ç›‘æ§ä¿®å¤**
   - ä¿®å¤recordMetricæ–¹æ³•ä¸­çš„è¯­æ³•é”™è¯¯
   - ä¼˜åŒ–æ€§èƒ½æŒ‡æ ‡è®°å½•ï¼Œä½¿ç”¨æ¡ä»¶å±æ€§å±•å¼€è¯­æ³•
   - ç¡®ä¿å¯é€‰å±æ€§çš„æ­£ç¡®å¤„ç†

4. **apiClient.tsæ³›å‹ç±»å‹ä¿®å¤**
   - æ·»åŠ ç±»å‹æ–­è¨€(as T)è§£å†³æ³›å‹è¿”å›ç±»å‹é—®é¢˜
   - ç¡®ä¿APIå“åº”æ•°æ®çš„ç±»å‹å®‰å…¨

5. **errorHandler.tsé”™è¯¯å¤„ç†ä¼˜åŒ–**
   - ç®€åŒ–isRetryableErroræ–¹æ³•çš„å®ç°
   - æ˜ç¡®å®šä¹‰å¯é‡è¯•é”™è¯¯ç ç±»å‹
   - æé«˜ä»£ç å¯è¯»æ€§å’Œç±»å‹å®‰å…¨æ€§

6. **æµ‹è¯•æ–‡ä»¶å¯¼å…¥è·¯å¾„ä¿®å¤**
   - ä¿®æ­£æµ‹è¯•æ–‡ä»¶ä¸­çš„ç›¸å¯¹å¯¼å…¥è·¯å¾„
   - ç¡®ä¿æµ‹è¯•èƒ½å¤Ÿæ­£ç¡®è¿è¡Œ

**æŠ€æœ¯è¦ç‚¹ï¼š**
- ä¸¥æ ¼éµå¾ªTypeScriptçš„exactOptionalPropertyTypesé…ç½®
- ä½¿ç”¨ç°ä»£JavaScriptè¯­æ³•(ç©ºå€¼åˆå¹¶ã€æ¡ä»¶å±æ€§å±•å¼€)
- ä¿æŒä»£ç çš„ç±»å‹å®‰å…¨å’Œè¿è¡Œæ—¶ç¨³å®šæ€§
- ä¼˜åŒ–é”™è¯¯å¤„ç†å’Œæ€§èƒ½ç›‘æ§çš„å®ç°

### 2024-12-19 ä»£ç å®ç°å®Œæˆ

#### æ ¸å¿ƒä»£ç å¼€å‘
1. **é¡¹ç›®ç»“æ„æ­å»º**
   - åˆ›å»º `package.json` å’Œ `tsconfig.json` é…ç½®æ–‡ä»¶
   - è®¾ç½® TypeScript ç¼–è¯‘é…ç½®å’Œé¡¹ç›®ä¾èµ–
   - é…ç½® ESLint ä»£ç è§„èŒƒå’Œ Vitest æµ‹è¯•æ¡†æ¶

2. **ç±»å‹å®šä¹‰å®ç°** (`src/types/`)
   - `ApiTypes.ts`: å®šä¹‰æ’ä»¶è¾“å…¥è¾“å‡ºã€API è¯·æ±‚å“åº”ç­‰æ ¸å¿ƒç±»å‹
   - `ErrorTypes.ts`: å®ç°ç»Ÿä¸€é”™è¯¯ç±»å‹ã€é”™è¯¯ç å¸¸é‡å’Œ `KnowsError` ç±»
   - æä¾›å®Œæ•´çš„ TypeScript ç±»å‹å®‰å…¨æ”¯æŒ

3. **å·¥å…·å‡½æ•°å¼€å‘** (`src/utils/`)
   - `validation.ts`: å®ç°è¾“å…¥éªŒè¯ã€API Key æ ¼å¼æ£€æŸ¥ã€å†…å®¹æ¸…ç†ç­‰åŠŸèƒ½
   - `performance.ts`: å¼€å‘æ€§èƒ½ç›‘æ§ç±»ï¼Œæ”¯æŒè¯·æ±‚è€—æ—¶ç»Ÿè®¡å’ŒæˆåŠŸç‡ç›‘æ§
   - `errorHandler.ts`: åˆ›å»ºç»Ÿä¸€é”™è¯¯å¤„ç†æœºåˆ¶ï¼Œæä¾›ç”¨æˆ·å‹å¥½é”™è¯¯ä¿¡æ¯

4. **æœåŠ¡å±‚å®ç°** (`src/services/`)
   - `apiClient.ts`: å®ç° HTTP å®¢æˆ·ç«¯ï¼Œé›†æˆè¶…æ—¶æ§åˆ¶ã€é”™è¯¯å¤„ç†å’Œæ€§èƒ½ç›‘æ§
   - `knowsService.ts`: å¼€å‘ä¸šåŠ¡é€»è¾‘å±‚ï¼Œå¤„ç† AI æœç´¢è¯·æ±‚å’Œç»“æœæ ¼å¼åŒ–

5. **ä¸»å…¥å£å¼€å‘** (`src/index.ts`)
   - é›†æˆæ‰€æœ‰æ¨¡å—ï¼Œå®ç°å®Œæ•´çš„æ’ä»¶åŠŸèƒ½
   - æ·»åŠ å…¨é¢çš„é”™è¯¯å¤„ç†å’Œæ€§èƒ½ç›‘æ§
   - ç¡®ä¿æ’ä»¶ç¨³å®šæ€§ï¼Œé”™è¯¯æ—¶è¿”å›ç»“æœè€ŒéæŠ›å‡ºå¼‚å¸¸

#### æµ‹è¯•å’Œè´¨é‡ä¿è¯
1. **å•å…ƒæµ‹è¯•ç¼–å†™**
   - `__tests__/index.test.ts`: ä¸»å…¥å£å‡½æ•°æµ‹è¯•
   - `__tests__/validation.test.ts`: è¾“å…¥éªŒè¯å·¥å…·æµ‹è¯•
   - é…ç½® Vitest æµ‹è¯•æ¡†æ¶å’Œè¦†ç›–ç‡æŠ¥å‘Š

2. **ä»£ç è´¨é‡å·¥å…·**
   - ESLint é…ç½®ï¼Œç¡®ä¿ä»£ç è§„èŒƒä¸€è‡´æ€§
   - TypeScript ä¸¥æ ¼æ¨¡å¼ï¼Œæä¾›ç±»å‹å®‰å…¨ä¿éšœ
   - å®Œæ•´çš„é¡¹ç›®æ–‡æ¡£å’Œ README

#### æŠ€æœ¯ç‰¹æ€§
- **ç±»å‹å®‰å…¨**: å®Œæ•´çš„ TypeScript ç±»å‹å®šä¹‰ï¼Œé¿å…è¿è¡Œæ—¶é”™è¯¯
- **é”™è¯¯å¤„ç†**: ç»Ÿä¸€çš„é”™è¯¯å¤„ç†æœºåˆ¶ï¼Œç”¨æˆ·å‹å¥½çš„é”™è¯¯ä¿¡æ¯
- **æ€§èƒ½ç›‘æ§**: å®æ—¶æ€§èƒ½æŒ‡æ ‡è®°å½•ï¼Œæ”¯æŒé—®é¢˜æ’æŸ¥å’Œä¼˜åŒ–
- **è¾“å…¥éªŒè¯**: å…¨é¢çš„å‚æ•°éªŒè¯å’Œå†…å®¹æ¸…ç†ï¼Œé˜²æ­¢æ¶æ„è¾“å…¥
- **æ¨¡å—åŒ–è®¾è®¡**: æ¸…æ™°çš„ä»£ç ç»“æ„ï¼Œä¾¿äºç»´æŠ¤å’Œæ‰©å±•

#### ä»£ç è´¨é‡äº®ç‚¹
- ä½¿ç”¨è£…é¥°å™¨æ¨¡å¼å®ç°æ€§èƒ½ç›‘æ§
- å®ç°äº†å¯é‡è¯•é”™è¯¯åˆ¤æ–­æœºåˆ¶
- æ·»åŠ äº† API å¥åº·æ£€æŸ¥åŠŸèƒ½
- æ”¯æŒæ€§èƒ½æ•°æ®è‡ªåŠ¨æ¸…ç†ï¼Œé¿å…å†…å­˜æ³„æ¼
- æä¾›è¯¦ç»†çš„é”™è¯¯ä¸Šä¸‹æ–‡ä¿¡æ¯

### 2024-12-19 API URL ä¿®æ­£
- **ä¿®æ­£ç”Ÿäº§ç¯å¢ƒ API URL**: æ ¹æ®å®˜æ–¹ API æ–‡æ¡£ï¼Œå°† base URL ä¿®æ­£ä¸º `https://api.nullht.com`
- **ç¡®ä¿ API è°ƒç”¨æ­£ç¡®æ€§**: æ›´æ–°åçš„ URL ä¸å®˜æ–¹æ–‡æ¡£ä¿æŒä¸€è‡´ï¼Œç¡®ä¿ API è°ƒç”¨èƒ½å¤Ÿæ­£å¸¸å·¥ä½œ

### 2024-12-19 ä»£ç è´¨é‡ä¼˜åŒ–

#### ä¸»è¦ä¼˜åŒ–å†…å®¹
1. **é”™è¯¯å¤„ç†æ ‡å‡†åŒ–**
   - æ–°å¢ `ErrorTypes.ts` å®šä¹‰ç»Ÿä¸€é”™è¯¯ç±»å‹å’Œé”™è¯¯ç 
   - å®ç° `KnowsError` ç±»æä¾›ç”¨æˆ·å‹å¥½çš„é”™è¯¯ä¿¡æ¯
   - åœ¨ API å®¢æˆ·ç«¯ã€æœåŠ¡å±‚å’Œä¸»å…¥å£æ–‡ä»¶ä¸­é›†æˆç»Ÿä¸€é”™è¯¯å¤„ç†

2. **é…ç½®éªŒè¯æœºåˆ¶**
   - æ–°å¢ `utils/validation.ts` æä¾›å®Œæ•´çš„è¾“å…¥éªŒè¯
   - å®ç° `validateApiKey`ã€`validateQuery`ã€`validateAnswerType` ç­‰éªŒè¯å‡½æ•°
   - æ·»åŠ è¾“å…¥å†…å®¹æ¸…ç†åŠŸèƒ½ `sanitizeInput`

3. **æ€§èƒ½ç›‘æ§å’Œæ—¥å¿—**
   - æ–°å¢ `utils/performance.ts` å®ç°æ€§èƒ½ç›‘æ§ç±» `PerformanceMonitor`
   - é›†æˆè¯·æ±‚è€—æ—¶ç»Ÿè®¡ã€æˆåŠŸç‡ç›‘æ§ã€é”™è¯¯è¿½è¸ª
   - åœ¨å…³é”®èŠ‚ç‚¹æ·»åŠ æ€§èƒ½æŒ‡æ ‡è®°å½•å’Œæ—¥å¿—è¾“å‡º

#### æŠ€æœ¯è¦ç‚¹
- **API å®¢æˆ·ç«¯ä¼˜åŒ–**: æ·»åŠ è¶…æ—¶æ§åˆ¶ï¼ˆ30ç§’ï¼‰ã€AbortController æ”¯æŒã€è¯¦ç»†é”™è¯¯ä¿¡æ¯è®°å½•
- **æœåŠ¡å±‚å¢å¼º**: é›†æˆè¾“å…¥éªŒè¯ã€å“åº”æ•°æ®éªŒè¯ã€æ€§èƒ½æŒ‡æ ‡è®°å½•
- **ä¸»å…¥å£ç¨³å®šæ€§**: æ”¹ä¸ºè¿”å›é”™è¯¯ç»“æœè€ŒéæŠ›å‡ºå¼‚å¸¸ï¼Œç¡®ä¿æ’ä»¶ç¨³å®šæ€§

#### é”™è¯¯å¤„ç†æ”¹è¿›
- ç»Ÿä¸€é”™è¯¯ç å®šä¹‰ï¼ˆVALIDATION_ERRORã€API_ERRORã€NETWORK_ERRORã€TIMEOUT_ERRORï¼‰
- ç”¨æˆ·å‹å¥½é”™è¯¯ä¿¡æ¯æ˜ å°„
- è¯¦ç»†çš„é”™è¯¯ä¸Šä¸‹æ–‡è®°å½•

#### æ€§èƒ½ç›‘æ§ç‰¹æ€§
- è¯·æ±‚çº§åˆ«çš„è€—æ—¶ç»Ÿè®¡
- æ“ä½œæˆåŠŸç‡è¿½è¸ª
- æ•°æ®ä¼ è¾“é‡ç›‘æ§
- é”™è¯¯åˆ†ç±»ç»Ÿè®¡

#### ä»£ç è´¨é‡æå‡
- å¢å¼ºç±»å‹å®‰å…¨æ€§
- å®Œå–„è¾“å…¥éªŒè¯å’Œæ¸…ç†
- ç»Ÿä¸€æ—¥å¿—æ ¼å¼å’Œé”™è¯¯å¤„ç†
- æ¨¡å—åŒ–è®¾è®¡ä¾¿äºç»´æŠ¤å’Œæ‰©å±•

è¿™äº›ä¼˜åŒ–ç¡®ä¿äº†ä»£ç çš„å¥å£®æ€§ã€å¯ç»´æŠ¤æ€§å’Œç”¨æˆ·ä½“éªŒï¼Œä¸ºåç»­åŠŸèƒ½æ‰©å±•å¥ å®šäº†åšå®åŸºç¡€ã€‚

## æµ‹è¯•ç”¨ä¾‹

### æµ‹è¯•ç”¨ä¾‹è®¾è®¡
```typescript
// src/__tests__/index.test.ts
describe('KnowS Plugin', () => {
  describe('AI æœç´¢æ¨¡å¼', () => {
    it('åº”è¯¥æ­£ç¡®å¤„ç†æœ‰æ•ˆçš„é—®ç­”è¯·æ±‚', async () => {
      const input = {
        apiKey: 'your-production-api-key',
        searchMode: 'ai_search',
        query: 'è€å¹´ç™Œç—‡æ‚£è€…å‡ºç°çœ©æ™•å’Œå¿ƒæ‚¸çš„åŸå› ',
        answerType: ['CLINICAL']
      };
      
      const result = await handler(input);
      expect(result).toHaveProperty('result');
      expect(result).toHaveProperty('evidences');
    });
  });

  describe('é”™è¯¯å¤„ç†', () => {
    it('åº”è¯¥å¤„ç†ç¼ºå¤± API Key çš„æƒ…å†µ', async () => {
      const input = {
        searchMode: 'ai_search',
        query: 'æµ‹è¯•é—®é¢˜'
      };
      
      await expect(handler(input)).rejects.toThrow('API Key ä¸èƒ½ä¸ºç©º');
    });
  });
});
```

## ğŸ“š æ–‡æ¡£è§„èŒƒ

### README.md å†…å®¹
- æ’ä»¶åŠŸèƒ½ä»‹ç»
- å®‰è£…å’Œé…ç½®è¯´æ˜
- ä½¿ç”¨ç¤ºä¾‹å’Œæœ€ä½³å®è·µ
- API å‚è€ƒæ–‡æ¡£
- æ•…éšœæ’é™¤æŒ‡å—

### ä»£ç æ³¨é‡Šè§„èŒƒ
- å…³é”®ä¸šåŠ¡é€»è¾‘æ·»åŠ ä¸­æ–‡æ³¨é‡Š
- API æ¥å£æ–¹æ³•æä¾›å®Œæ•´çš„ JSDoc æ³¨é‡Š
- å¤æ‚ç®—æ³•å’Œæ•°æ®å¤„ç†é€»è¾‘è¯¦ç»†è¯´æ˜

## ğŸš€ éƒ¨ç½²å’Œå‘å¸ƒ

### å‘å¸ƒå‰æ£€æŸ¥æ¸…å•
- [ ] æ‰€æœ‰æµ‹è¯•ç”¨ä¾‹é€šè¿‡
- [ ] TypeScript ç±»å‹æ£€æŸ¥æ— é”™è¯¯
- [ ] ESLint ä»£ç è§„èŒƒæ£€æŸ¥é€šè¿‡
- [ ] API å¯†é’¥å®‰å…¨æ€§æ£€æŸ¥
- [ ] æ–‡æ¡£å®Œæ•´æ€§æ£€æŸ¥
- [ ] ç‰ˆæœ¬å·æ›´æ–°

### ç‰ˆæœ¬ç®¡ç†ç­–ç•¥
- **ä¸»ç‰ˆæœ¬**: é‡å¤§åŠŸèƒ½å˜æ›´æˆ– API ä¸å…¼å®¹æ›´æ–°
- **æ¬¡ç‰ˆæœ¬**: æ–°åŠŸèƒ½æ·»åŠ ï¼Œå‘åå…¼å®¹
- **ä¿®è®¢ç‰ˆæœ¬**: Bug ä¿®å¤å’Œæ€§èƒ½ä¼˜åŒ–

## âš ï¸ é£é™©è¯„ä¼°å’Œç¼“è§£

### æŠ€æœ¯é£é™©
1. **API é™æµ**: å®ç°è¯·æ±‚é¢‘ç‡æ§åˆ¶å’Œé‡è¯•æœºåˆ¶
2. **ç½‘ç»œè¶…æ—¶**: è®¾ç½®åˆç†çš„è¶…æ—¶æ—¶é—´å’Œé”™è¯¯å¤„ç†
3. **æ•°æ®å®‰å…¨**: API Key åŠ å¯†å­˜å‚¨ï¼Œé¿å…æ—¥å¿—æ³„éœ²

### ä¸šåŠ¡é£é™©
1. **æœåŠ¡å¯ç”¨æ€§**: å®ç°é™çº§ç­–ç•¥å’Œé”™è¯¯æç¤º
2. **ç”¨æˆ·ä½“éªŒ**: æä¾›æ¸…æ™°çš„é”™è¯¯ä¿¡æ¯å’Œä½¿ç”¨æŒ‡å¯¼
3. **æ€§èƒ½å½±å“**: ä¼˜åŒ–è¯·æ±‚å¤„ç†å’Œå“åº”æ—¶é—´

## ğŸ“ˆ åç»­ä¼˜åŒ–æ–¹å‘

### åŠŸèƒ½å¢å¼º
1. **ç¼“å­˜æœºåˆ¶**: å®ç°æ™ºèƒ½ç¼“å­˜å‡å°‘é‡å¤è¯·æ±‚
2. **æ‰¹é‡å¤„ç†**: æ”¯æŒæ‰¹é‡æŸ¥è¯¢å’Œå¤„ç†
3. **ç»“æœè¿‡æ»¤**: æä¾›æ›´ç²¾ç»†çš„ç»“æœç­›é€‰é€‰é¡¹

### æ€§èƒ½ä¼˜åŒ–
1. **å¹¶å‘æ§åˆ¶**: ä¼˜åŒ–å¹¶å‘è¯·æ±‚å¤„ç†
2. **å†…å­˜ç®¡ç†**: ä¼˜åŒ–å¤§æ•°æ®é‡å¤„ç†çš„å†…å­˜ä½¿ç”¨
3. **å“åº”å‹ç¼©**: å®ç°å“åº”æ•°æ®å‹ç¼©ä¼ è¾“

---

**æœ¬è®¾è®¡æ–‡æ¡£éµå¾ª FastGPT æ’ä»¶å¼€å‘æœ€ä½³å®è·µï¼Œç¡®ä¿ä»£ç è´¨é‡ã€å¯ç»´æŠ¤æ€§å’Œç”¨æˆ·ä½“éªŒã€‚** ğŸ¯